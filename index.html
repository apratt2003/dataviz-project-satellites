<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://d3js.org/topojson.v1.min.js"></script>
</head>
<style>
  .satellite{
    fill:#8E8883
  }
</style>

<body>
  <svg width="960" height="500"></svg>
  <script>
    const svg = d3.select('svg');
    const path = svg.append('path');
    const projection = d3.geoOrthographic();
    const initialGlobeScale = projection.scale();
    const geoPath = d3.geoPath().projection(projection);
    const sensitivity = 58;

    const dragzoom = function(render1, render2){
      svg
        .call(d3.drag().on('drag', () => {
          const rotate = projection.rotate();
          const k = sensitivity / projection.scale();
          projection.rotate([
            rotate[0] + d3.event.dx * k,
            rotate[1] - d3.event.dy * k
          ])
          render1();
          render2();
          //console.log(renderGEOs);
        }))
        .call(d3.zoom().on('zoom', () => {
          projection.scale(initialGlobeScale * d3.event.transform.k);
          render1();
          //renderGlobe();
          render2();

        }));
    }

    //add globe
    d3.json('world-110m.v1.json', (error, world) => {
      const land = topojson.feature(world, world.objects.land);
      const renderglobe = function() {path.attr('d', geoPath(land))};
      renderglobe();
      //renderGEOs();
      dragzoom(renderglobe)
    });

    // add circles for satellites

    var renderGEOs = function(){};

     d3.csv("GEOs.csv", function(GEOs){

      renderGEOs = function() {
        //var inclination = GEOs.map(function(d) {return +d.Inclinationdegrees});
        var SatCoord = GEOs.map(function(d) { return projection([+d.LongitudeOfGEO, +d.Inclinationdegrees]);
             });

       var sat = svg.selectAll("circle")
           .data(SatCoord)

      sat.enter().append("circle")
                .attr("cx", function (d) { return (d[0]);}) //Longitude
                .attr("cy", function (d) { return (d[1]);}) //Latitude
                .attr("r", 4)
                .attr("class", "satellite")
            .merge(sat)
                .attr("cx", function (d) { return (d[0]);}) //Longitude
                .attr("cy", function (d) { return (d[1]);}); //Latitude

      //  console.log(SatCoord[1]);
           }
        renderGEOs();
        dragzoom(renderGEOs);

      });

      	//renderGEOs();
        //dragzoom(renderglobe, renderGEOs);
        //10.35
  </script>
</body>
